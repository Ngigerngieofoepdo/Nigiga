local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local toolsFolder = workspace:WaitForChild("Map"):WaitForChild("Ignore"):WaitForChild("Tools")
local remote = workspace.Services:WaitForChild("PickupTool")

-- Create Screen GUI
local screenGui = Instance.new("ScreenGui", playerGui)
screenGui.Name = "ToolPickerGui"

-- Create Scrolling Frame
local scrollingFrame = Instance.new("ScrollingFrame", screenGui)
scrollingFrame.Size = UDim2.new(0.5, 0, 0.5, 0)
scrollingFrame.Position = UDim2.new(0.25, 0, 0.25, 0)
scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0) -- Will be updated later
scrollingFrame.ScrollBarThickness = 10

-- Create UI List Layout
local uiListLayout = Instance.new("UIListLayout", scrollingFrame)
uiListLayout.FillDirection = Enum.FillDirection.Vertical
uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
uiListLayout.Padding = UDim.new(0, 5)

-- Function to create buttons for each tool
local function createToolButton(tool)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 0, 50)
    button.Text = tool.Name
    button.Parent = scrollingFrame

    button.MouseButton1Click:Connect(function()
        local args = {
            [1] = "#" .. tool.Name,
            [2] = tool.Name .. "#" .. tool:GetAttribute("ID") -- Assuming there's an ID attribute or similar
        }
        remote:InvokeServer(unpack(args))
        player.Character.HumanoidRootPart.CFrame = tool.CFrame -- Teleport to the tool
    end)
end

-- Populate the scrolling frame with tools
for _, tool in ipairs(toolsFolder:GetChildren()) do
    if tool:IsA("Tool") then
        createToolButton(tool)
    end
end

-- Adjust CanvasSize to fit all buttons
scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, uiListLayout.AbsoluteContentSize.Y)

-- Make GUI draggable for mobile
local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    screenGui.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

screenGui.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = screenGui.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

screenGui.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch and dragging then
        update(input)
    end
end)

print("Tool Picker GUI created successfully!")
